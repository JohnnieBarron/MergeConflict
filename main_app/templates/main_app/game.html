 {% extends 'base.html' %}
  {% load static %}

  {% block content %}
  <div class="game-container">
      <div class="game-header">
          <h2>Room: {{ room.name }}</h2>
          <p>Round {{ current_round.round_number }} of {{ room.round_limit }}</p>
      </div>

      <!-- Black Card Section -->
      <div class="black-card-section">
          <h3>Black Card</h3>
          <div class="card black-card">
              <p>{{ current_round.black_card.text }}</p>
              <small>Pick {{ current_round.black_card.pick }}</small>
          </div>
      </div>

      <!-- Player Status -->
      <div class="player-info">
          <p>Your Score: {{ player.score }}</p>
          {% if is_judge %}
              <p class="judge-badge">üë®‚Äç‚öñÔ∏è You are the Card Czar!</p>
          {% endif %}
      </div>

      <!-- Game Phase Content -->
      {% if current_round.status == 'card_selection' %}
          {% if not is_judge %}
              {% if not has_submitted %}
                  <!-- Player's Hand -->
                  <div class="hand-section">
                      <h3>Your Cards</h3>
                      <form method="post" action="{% url 'submit_card' room.room_code %}">
                          {% csrf_token %}
                          <div class="card-grid">
                              {% for card in player.card_hand %}
                                  <label class="card white-card">
                                      <input type="radio" name="card_id" value="{{ card.id }}" required>
                                      <p>{{ card.text }}</p>
                                  </label>
                              {% endfor %}
                          </div>
                          <button type="submit" class="btn btn-primary">Submit Card</button>
                      </form>
                  </div>
              {% else %}
                  <p class="waiting-message">Waiting for other players to submit...</p>
              {% endif %}
          {% else %}
              <p class="waiting-message">Waiting for players to submit their cards...</p>
          {% endif %}
      {% endif %}

      {% if current_round.status == 'judging' %}
          {% if is_judge %}
              <!-- Judge View -->
              <div class="judging-section">
                  <h3>Select the Winner</h3>
                  <form method="post" action="{% url 'select_winner' room.room_code %}">
                      {% csrf_token %}
                      <div class="submissions-grid">
                          {% for submission in submissions %}
                              <label class="card white-card submission">
                                  <input type="radio" name="submission_id" value="{{ submission.id }}" required>
                                  {% for card in submission.white_cards %}
                                      <p>{{ card.text }}</p>
                                  {% endfor %}
                              </label>
                          {% endfor %}
                      </div>
                      <button type="submit" class="btn btn-primary">Select Winner</button>
                  </form>
              </div>
          {% else %}
              <p class="waiting-message">The Card Czar is choosing a winner...</p>
          {% endif %}
      {% endif %}

      <!-- Players List -->
      <div class="players-sidebar">
          <h3>Players</h3>
          <ul class="players-list">
              {% for game_player in players %}
                  <li>
                      {{ game_player.user.username }}
                      <span class="score">{{ game_player.score }} points</span>
                      {% if current_round.judge == game_player.user %}
                          <span class="judge-indicator">üë®‚Äç‚öñÔ∏è</span>
                      {% endif %}
                  </li>
              {% endfor %}
          </ul>
      </div>
  </div>

  <style>
  .game-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
  }

  .card {
      border: 2px solid #333;
      border-radius: 8px;
      padding: 20px;
      margin: 10px;
      cursor: pointer;
      transition: transform 0.2s;
  }

  .black-card {
      background-color: #000;
      color: #fff;
      font-size: 1.2em;
  }

  .white-card {
      background-color: #fff;
      color: #000;
      position: relative;
  }

  .white-card:hover {
      transform: scale(1.05);
  }

  .white-card input[type="radio"] {
      position: absolute;
      opacity: 0;
  }

  .white-card input[type="radio"]:checked + p {
      font-weight: bold;
  }

  .card-grid, .submissions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
  }

  .players-sidebar {
      position: fixed;
      right: 20px;
      top: 100px;
      background: #f5f5f5;
      padding: 20px;
      border-radius: 8px;
  }

  .judge-badge {
      background: #FFD700;
      color: #000;
      padding: 5px 10px;
      border-radius: 5px;
      font-weight: bold;
  }

  .waiting-message {
      text-align: center;
      font-size: 1.2em;
      color: #666;
      margin: 40px 0;
  }
  </style>

  <script>
  // Poll for game status updates every 3 seconds
  setInterval(function() {
      fetch("{% url 'game_status' room.room_code %}")
          .then(response => response.json())
          .then(data => {
              // Reload page if round status changes
              if (data.round_status !== "{{ current_round.status }}") {
                  location.reload();
              }
          });
  }, 3000);
  </script>
  {% endblock %}
